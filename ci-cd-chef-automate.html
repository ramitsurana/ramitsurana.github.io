<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Automating your CI/CD with Chef Automate & Habitat</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Ramit Surana Personal Blog" />
    <link rel="shortcut icon" href="/assets/images/favicon.png" type="image/png" />
    <link rel="canonical" href="/ci-cd-chef-automate" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Ramit Surana" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Automating your CI/CD with Chef Automate & Habitat" />
    <meta property="og:description" content="Habitat Introduction to Habitat Habitat Architecture Habitat Builder Habitat Studio Docker Vs Habitat Chef Automate Introduction to Chef Automate Trying Out on Local System Chef Automate Setup on AWS EC2 Prerequisites Setup Chef Automate Internals Tips &amp; Tricks on CI/CD Conclusion Hallo Freunde (German)(Hello Friends),As Martin Fowler correctly explains continous" />
    <meta property="og:url" content="/ci-cd-chef-automate" />
    <meta property="og:image" content="/assets/images/piano.jpg" />
    <meta property="article:publisher" content="https://www.facebook.com/ramitsurana" />
    <meta property="article:author" content="https://www.facebook.com/ramitsurana" />
    <meta property="article:published_time" content="2018-01-14T00:00:00+00:00" />
    <meta property="article:modified_time" content="2018-01-14T00:00:00+00:00" />
    <meta property="article:tag" content="Chef" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Automating your CI/CD with Chef Automate & Habitat" />
    <meta name="twitter:description" content="Habitat Introduction to Habitat Habitat Architecture Habitat Builder Habitat Studio Docker Vs Habitat Chef Automate Introduction to Chef Automate Trying Out on Local System Chef Automate Setup on AWS EC2 Prerequisites Setup Chef Automate Internals Tips &amp; Tricks on CI/CD Conclusion Hallo Freunde (German)(Hello Friends),As Martin Fowler correctly explains continous" />
    <meta name="twitter:url" content="/" />
    <meta name="twitter:image" content="/assets/images/piano.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Ramit Surana" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Chef" />
    <meta name="twitter:site" content="@ramitsurana" />
    <meta name="twitter:creator" content="@ramitsurana" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Ramit Surana",
        "logo": "/"
    },
    "url": "/ci-cd-chef-automate",
    "image": {
        "@type": "ImageObject",
        "url": "/assets/images/piano.jpg",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "/ci-cd-chef-automate"
    },
    "description": "Habitat Introduction to Habitat Habitat Architecture Habitat Builder Habitat Studio Docker Vs Habitat Chef Automate Introduction to Chef Automate Trying Out on Local System Chef Automate Setup on AWS EC2 Prerequisites Setup Chef Automate Internals Tips &amp; Tricks on CI/CD Conclusion Hallo Freunde (German)(Hello Friends),As Martin Fowler correctly explains continous"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Automating your CI/CD with Chef Automate & Habitat" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="/">Ramit Surana</a>
            
        
        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
                <a class="social-link social-link-fb" href="https://facebook.com/ramitsurana" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
</a>
            
            
                <a class="social-link social-link-tw" href="https://twitter.com/ramitsurana" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Subscribe</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-chef tag-ci-cd tag-jenkins tag-habitat tag-automate post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="14 January 2018">14 January 2018</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/chef/'>CHEF</a>,
                            
                        
                            
                               <a href='/tag/ci-cd/'>CI/CD</a>,
                            
                        
                            
                               <a href='/tag/jenkins/'>JENKINS</a>,
                            
                        
                            
                               <a href='/tag/habitat/'>HABITAT</a>,
                            
                        
                            
                               <a href='/tag/automate/'>AUTOMATE</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Automating your CI/CD with Chef Automate & Habitat</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/images/piano.jpg)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <ul>
  <li><a href="#habitat">Habitat</a>
    <ul>
      <li><a href="#introduction-to-habitat">Introduction to Habitat</a></li>
      <li><a href="#habitat-architecture">Habitat Architecture</a></li>
      <li><a href="#habitat-builder">Habitat Builder</a></li>
      <li><a href="#habitat-studio">Habitat Studio</a></li>
      <li><a href="#docker-vs-habitat">Docker Vs Habitat</a></li>
    </ul>
  </li>
  <li><a href="#chef-automate">Chef Automate</a>
    <ul>
      <li><a href="#introduction-to-chef-automate">Introduction to Chef Automate</a></li>
    </ul>
  </li>
  <li><a href="#trying-out-on-local-system">Trying Out on Local System</a>
    <ul>
      <li><a href="#chef-automate-setup-on-aws-ec2">Chef Automate Setup on AWS EC2</a>
        <ul>
          <li><a href="#prerequisites">Prerequisites</a></li>
          <li><a href="#setup">Setup</a></li>
        </ul>
      </li>
      <li><a href="#chef-automate-internals">Chef Automate Internals</a></li>
    </ul>
  </li>
  <li><a href="#tips-and-tricks-on-ci-cd">Tips &amp; Tricks on CI/CD</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>

<p>Hallo Freunde (German)(Hello Friends),As <a href="http://martinfowler.com">Martin Fowler</a> correctly explains continous delivery:</p>

<blockquote>
  <p>Continuous Delivery is a software development discipline where you build software in such a way that the software can be released to production at any time.The primary goal of the process is to be production ready anytime and anywhere.</p>
</blockquote>

<p>In this simple and amazing piece of article we are going to discuss and explore some new amazing and rather interesting pieces technology.One i.e. Habitat,an Automation tool that Automates your process to build and publish Docker Images and Second i.e. Automate, which is a new chef CI/CD tool with a cool new dashboard &amp; better features.As an added bonus I am  also going to share some nice tips that I use to make my life easier while handling the CI/CD pipelines.So let’s get started,</p>

<h2 id="habitat">Habitat</h2>

<h3 id="introduction-to-habitat">Introduction to Habitat</h3>

<p>Habitat is a new amazing tool introduced by Chef.It basically tries to serve one motive i.e. to automate the process of making a container image as easily as possible.You can think of it as <strong>Dockerfile</strong> for the docker except that it has some new features for building images and process to publish it in CI/CD perspective. The tool has been introduced in 2016 &amp; is still into development phase. It is written in rust and reactive by nature. Now let’s do some installation:</p>

<p>First, visit https://github.com/habitat-sh/habitat#install :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl https://raw.githubusercontent.com/habitat-sh/habitat/master/components/hab/install.sh | sudo bash
</code></pre></div></div>

<p>After the installation, try running it on the command line using the below command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ hab
hab 0.51.0/20171219021329

Authors: The Habitat Maintainers &lt;humans@habitat.sh&gt;
"A Habitat is the natural environment for your services" - Alan Turing

USAGE:
    hab [SUBCOMMAND]

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

SUBCOMMANDS:
    bldr      Commands relating to Habitat Builder
    cli       Commands relating to Habitat runtime config
    config    Commands relating to Habitat runtime config
    file      Commands relating to Habitat files
    help      Prints this message or the help of the given subcommand(s)
    origin    Commands relating to Habitat origin keys
    pkg       Commands relating to Habitat packages
    plan      Commands relating to plans and other app-specific configuration.
    ring      Commands relating to Habitat rings
    studio    Commands relating to Habitat Studios
    sup       Commands relating to the Habitat Supervisor
    svc       Commands relating to Habitat services
    user      Commands relating to Habitat users


ALIASES:
    apply      Alias for: 'config apply'
    install    Alias for: 'pkg install'
    run        Alias for: 'sup run'
    setup      Alias for: 'cli setup'
    start      Alias for: 'svc start'
    stop       Alias for: 'svc stop'
    term       Alias for: 'sup term'

</code></pre></div></div>

<p>If you receive the above output, then you have successfully installed habitat.</p>

<h3 id="habitat-architecture">Habitat Architecture</h3>

<p><img src="https://user-images.githubusercontent.com/8342133/34907583-145ce07a-f8a7-11e7-9c73-8f020a1cb739.png" alt="chef-habitat" /></p>

<p>Now upon closely looking at its architecture and how to write it. You can clearly observe the various files one has to write in order to bring up the container/image. The main file in this section is the <strong>plan.sh</strong> file which is responsible for the deployment strategy/dependencies/package name of the habitat image. It is mandatory to make this file and configure it properly in order to achieve the best results.</p>

<p>Next, is the <strong>default.toml</strong> file. This file contains the information about the ports and external configurations of your application that you have. It is similar to having <strong>nginx.conf</strong> for <strong>nginx</strong> or <strong>apache2conf</strong> for <strong>apache</strong>, which I believe is an interesting and good idea.</p>

<p>For the hooks part, I observed its usage while exploring some of the samples provided by habitat team in there docs.In simple terms, it is basically breaking down your requirements as per your application into multiple stages each having its priority in different order while running your application. Like we have <strong>Entrypoint</strong> in <strong>Dockerfile</strong>. For example, Here the file <strong>Init</strong> in scripts contains your initialization commands.</p>

<p>Some sample examples:</p>

<script src="https://gist.github.com/ramitsurana/96e38aab74ea5529f89d02bbd8822493.js"></script>

<h3 id="habitat-builder">Habitat Builder</h3>

<p>The Habitat Builder is a place similar to Docker Hub/Quay.io. It is a place where you can automatically check in you code with habitat and build a variety of different container images. It also enables you to publish your docker images on docker hub by connecting your docker hub account.To get started sign up at <a href="https://bldr.habitat.sh">Habitat Builder</a>.</p>

<p><img src="https://user-images.githubusercontent.com/8342133/34906971-4004eb8c-f89d-11e7-8241-4761a59d8563.png" alt="habitat1" /></p>

<p>The term origin here can be defined as a namespace which is created by the user/organization to build one’s own packages. It is similar to defining your name in the dockerhub account.</p>

<p><img src="https://user-images.githubusercontent.com/8342133/34907004-c936141c-f89d-11e7-88fe-85277ac813a0.png" alt="habitat2" /></p>

<p>As you can observe from above Habitat asks you to connect your GitHub account and specify the path to which your plan.sh file is placed. It has a by default path under the habitat folder in which it searches your plan.sh file. You can specify your path and use the dockerhub integration if you wish to publish your images to dockerhub.</p>

<p>Similar to DockerHub, you can also connect your ECR Registry on your AWS account by visiting the Integrations section.</p>

<p><img src="https://user-images.githubusercontent.com/8342133/34907040-5400acba-f89e-11e7-9269-0ad62b71a6b5.png" alt="habitat3" /></p>

<p>After creating a package/build you can observe the dependencies by scrolling down the page:</p>

<p><img src="https://user-images.githubusercontent.com/8342133/34907085-34168d74-f89f-11e7-8c75-e5f7e7cc22be.png" alt="habitat4" /></p>

<p>Here you can observe that it consists of 2 sections, labelled as Transitive dependencies and Dependencies.In simple terms, the transitive dependencies can be labelled as a basic set of packages that are required by every application that you wish to build using docker. These are provisioned and managed by the Habitat Team. You can also treat it similar to the <strong>FROM</strong> Section when writing a Dockerfile.</p>

<p>On the other hand, Dependencies label is used to signify the extra packages you are using/mentioned in your <strong>plan.sh</strong> file being used by your application.</p>

<h3 id="habitat-studio">Habitat Studio</h3>

<p>Habitat Studio is a another important feature of Habitat that allows you to test and run you application in simulation to like a real enviornment before you publish it. If you are familiar with python, you can think it as similar as <a href="https://virtualenv.pypa.io/en/stable/">virtualenv</a>. So let’s try out hab studio.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ hab studio setup
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/8342133/34915287-a6e4174a-f949-11e7-8f62-e804f2756859.png" alt="habitat5" /></p>

<p>In the setup default origin, choose your name for origin. In my case I am taking it as <strong>ramitsurana</strong>.</p>

<p><img src="https://user-images.githubusercontent.com/8342133/34915299-d07925d2-f949-11e7-8ebb-104744fc4795.png" alt="habitat6" /></p>

<p><img src="https://user-images.githubusercontent.com/8342133/34915319-5787f03a-f94a-11e7-955e-bd8050449202.png" alt="habitat7" /></p>

<p>In order to achieve our objective we are going to use this github feature</p>

<p><img src="https://user-images.githubusercontent.com/8342133/34915325-70bca69a-f94a-11e7-9298-c0dc927471e0.png" alt="habitat8" /></p>

<p>In case you are wondering how to create a new access Github token, please open the following <a href="https://github.com/settings/tokens">url</a></p>

<p><img src="https://user-images.githubusercontent.com/8342133/34915423-6f297f68-f94c-11e7-9bd7-74c6b893bb6c.png" alt="github-access-token" /></p>

<p>Copy the generated token in the cli tool for hab &amp; you are good to go.</p>

<p><strong>Do make sure to save this token. We will use it in the next part of the article.</strong></p>

<h3 id="docker-vs-habitat">Docker Vs Habitat</h3>

<p><img src="https://user-images.githubusercontent.com/8342133/34904574-7af45216-f86e-11e7-87a0-1f2abf6aea3b.png" width="auto" height="auto" /></p>

<h2 id="chef-automate">Chef Automate</h2>

<h3 id="introduction-to-chef-automate">Introduction to Chef Automate</h3>

<p>Chef automate is a CI/CD Based solution provided by <a href="http://chef.io">Chef</a> to complete your end to end delivery requirements. It provides you with necessary tools to make your life easier and simple. It has by default integration for features &amp; tools like <a href="https://www.inspec.io/">Inspec</a> for Compliance, LDAP/SAML Support, <a href="http://www.slack.com">Slack</a> Integration for Notifications etc.</p>

<p><img src="https://user-images.githubusercontent.com/8342133/34904580-9db6c5ae-f86e-11e7-974e-87ead19b8dac.png" alt="chef-automate-habitat" /></p>

<h2 id="trying-out-on-local-system">Trying Out on Local System:</h2>

<p>Chef Automate can be easily tried on your local system by downloading Chef Automate from <a href="https://downloads.chef.io/automate">here</a></p>

<p>For the cli, Download the package from <a href="https://downloads.chef.io/automate">here</a> .</p>

<p>In order to check, try running:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ramit@ramit-Inspiron-3542:~$ automate-ctl
I don't know that command.
omnibus-ctl: command (subcommand)
create-enterprise
  Create a new enterprise
create-user
  Create a new user
create-users
  Create new users from a tsv file
delete-enterprise
  Deletes an existing enterprise
delete-project
  Deletes an existing project
delete-runner
.....
</code></pre></div></div>

<p>Check if everything is good or not:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ramit@ramit-Inspiron-3542:~$ sudo automate-ctl preflight-check
[sudo] password for ramit: 

Running Preflight Checks:
  Checking for required resources...
    ✔ [passed]  CPU at least 4 cores
    ✖ [failed]  memory at least 16GB
  Checking for required directories...
    ✔ [passed]  /var
    ✔ [passed]  /var has at least 80GB free
    ✔ [passed]  /etc
  Checking for required umask...
    ✔ [passed]  0022
....
</code></pre></div></div>

<p>For Authenticating License:</p>

<p>(Grab your free License from <a href="https://learn.chef.io/modules/try-chef-automate#/">here</a>)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Setup License &amp; organization
$ automate-ctl setup --license /$PATH/automate.license --server-url https://localhost/organizations/$org_name --enterprise default --configure --no-build-node

$ automate-ctl reconfigure

//Create a default user and password
$ automate-ctl create-user default $user --password admin --roles "admin"
</code></pre></div></div>
<p>Try opening <strong>http://127.0.0.1:80</strong> to interact with the Web UI.</p>

<h3 id="chef-automate-setup-on-aws-ec2">Chef Automate Setup on AWS EC2</h3>

<h4 id="prerequisites">Prerequisites</h4>

<p>In order for the Chef Automate Setup to work, we will use a minimal setup in order to proceed. Here are the configuration details:</p>

<table>
  <thead>
    <tr>
      <th>Category</th>
      <th style="text-align: center">Inbound Security Ports Access</th>
      <th style="text-align: left">Operating System &amp; Instance Size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Chef Server</td>
      <td style="text-align: center">22 (SSH), 80 (HTTP), 443 (HTTPS), 10000-10003 (push jobs)</td>
      <td style="text-align: left">Ubuntu 16.04(ami-21766642) &amp; t2.micro</td>
    </tr>
    <tr>
      <td>Chef Automate Server</td>
      <td style="text-align: center">22 (SSH), 80 (HTTP), 443 (HTTPS), 8989 (Git)</td>
      <td style="text-align: left">Ubuntu 16.04(ami-21766642) &amp; t2.large</td>
    </tr>
  </tbody>
</table>

<p>Do make sure to install the <strong>License file</strong> required for running Chef Automate from <a href="https://learn.chef.io/modules/try-chef-automate#/">here</a>.Its a 30 day free trial. As per its current <a href="https://www.chef.io/pricing/">pricing</a> page the fee for Chef Automate on AWS is $0.0155 node/hour.</p>

<p>Also, we will be using fully-qualified domain names (FQDNs) as recommended by Chef.</p>

<p>Please make sure to <strong>note the FQDN for both your Chef server and Chef Automate server</strong>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$CHEF_SERVER_FQDN="Public DNS NAME of Chef Server EC2 Instance"
$CHEF_AUTOMATE_FQDN="Public DNS NAME of Chef Automate EC2 Instance"
</code></pre></div></div>
<h4 id="setup">Setup</h4>

<p>Let’s get started:</p>

<p>Using the aws console,we can start 2 EC2 instances with ( t2.large ) instance type. Make sure to configre your security groups like shown below:</p>

<p><img src="https://user-images.githubusercontent.com/8342133/34915271-430eb8f6-f949-11e7-8674-d6bf5323480f.png" alt="chef-server-rules" /></p>

<p><strong>Make sure to add Port 8989 for Git with Chef-Automate Server.</strong></p>

<p>After bringing up the <strong>chef-server</strong> machine, please log into the machine and use git to clone the following repo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git clone https://github.com/ramitsurana/chef-automate-habitat
</code></pre></div></div>
<p>Run scripts/install-chef-server.sh :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Make sure to set the variable with proper DNS Name
$ CHEF_AUTOMATE_FQDN="Public DNS NAME of Chef Automate EC2 Instance"

// Add permissions to execute
$ chmod +x $HOME/chef-automate-habitat/scripts/install-chef-server.sh

// Run the script to install chef
$ sudo $HOME/chef-automate-habitat/scripts/install-chef-server.sh $CHEF_AUTOMATE_FQDN ramit
</code></pre></div></div>

<p>Successfully Copy Files to <strong>Chef Server</strong> from <strong>local machine</strong> using scp:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// License File
$ scp -i ~/.ssh/private_key -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null ~/Downloads/automate.license ubuntu@ec2-52-91-162-254.compute-1.amazonaws.com:/tmp
</code></pre></div></div>

<p>Successfully Copy Files to <strong>Chef Automate</strong> from <strong>Chef Server</strong> using scp:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//Copy New PEM File from Chef Server to your local machine
$ scp -i &lt;YOUR-EC2&gt;.pem -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null ubuntu@&lt;YOUR-CHEF-SERVER-DNS&gt;:/drop/delivery.pem /tmp

//Upload the delivery.pem file to Chef Automate instance 
$ scp -i &lt;YOUR-CHEF-AUTOMATE&gt;.pem -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null /tmp/delivery.pem ubuntu@&lt;YOUR-CHEF-AUTOMATE-DNS&gt;:/home/ubuntu

//Upload the your license file to Chef Automate instance 
$ scp -i &lt;YOUR-CHEF-AUTOMATE&gt;.pem -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null /&lt;PATH-TO-AUTOMATE-LICENSE&gt;.license ubuntu@&lt;YOUR-CHEF-AUTOMATE-DNS&gt;:/home/ubuntu
</code></pre></div></div>
<p>Now your Chef Server is fully up and ready. We now move onto Chef-Automate Sever, after getting into it using ssh. Follow these below steps:</p>

<p>Use git to clone the following repo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git clone https://github.com/ramitsurana/chef-automate-habitat
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Make sure to set the variable with proper DNS Name
$CHEF_SERVER_FQDN="Public DNS NAME of Chef Server EC2 Instance"

// Add permissions to execute
$ chmod +x $HOME/chef-automate-habitat/scripts/install-chef-automate.sh

// Run the script to install chef
$ sudo $HOME/chef-automate-habitat/scripts/install-chef-automate.sh $CHEF_SERVER_FQDN ramit
</code></pre></div></div>

<p>After completing the above steps, you can proceed to open the DNS/IP for Chef Automate Server</p>

<p><img src="https://user-images.githubusercontent.com/8342133/34936721-7687a976-fa08-11e7-9337-ec84521efdad.png" alt="chef-login" /></p>

<p>Hoorah ! You have successfully configures chef automate and now you are ready to login.</p>

<p>Let’s start exploring some new features of the Chef Automate Dashboard:</p>

<p>With your <strong>user name</strong> and password <strong>admin</strong>, try to login. You will observe the following screen:</p>

<p><img src="https://user-images.githubusercontent.com/8342133/34937222-1341306a-fa0a-11e7-9801-3c2cf4206785.png" alt="chef-login1" /></p>

<p>For shutting down chef automate:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo automate-ctl stop
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/8342133/34936511-b2b2e574-fa07-11e7-9497-502e7687af7b.png" alt="chef-automate-internals" /></p>

<h3 id="chef-automate-internals">Chef Automate Internals</h3>

<p>Some of the chef automate internals that I observed while exploring this tool are as follows:</p>

<p><img src="https://user-images.githubusercontent.com/8342133/34941142-801a87be-fa18-11e7-9bd6-a399548c082c.png" alt="chef-automate-arch" /></p>

<ul>
  <li><a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a></li>
  <li><a href="https://www.elastic.co/products/logstash">Logstash</a></li>
  <li><a href="https://www.nginx.com/">Nginx</a></li>
  <li><a href="https://www.postgresql.org/">Postgresql</a></li>
  <li><a href="https://www.rabbitmq.com/">RabbitMq</a></li>
</ul>

<p>We will be discussing more on this in the next article :)</p>

<h2 id="tips--tricks-on-cicd">Tips &amp; Tricks on CI/CD</h2>

<p>As a bonus, sharing some tips on building &amp; managing CI/CD in a better way:</p>

<ul>
  <li>Automate Liveness Agent</li>
</ul>

<p>You can also use chef automate <a href="https://github.com/chef/automate-liveness-agent">liveness agent</a> for sending keepalive messages to Chef Automate, which prevents nodes that are up but not frequently running Chef Client from appearing as “missing” in the Automate UI. At the time of writing, it is currently in development.</p>

<ul>
  <li>Using Syntax Checker</li>
</ul>

<p>One of the most primary starting point in CI/CD is to write a file using which we describe how our jobs are handled in the pipeline. For various tools, there are many syntax validators. I found them really useful. Some of there tools are:</p>

<ol>
  <li><a href="https://job-dsl.herokuapp.com/">Jenkins</a></li>
  <li><a href="https://gitlab.com/ci/lint">Gitlab</a></li>
  <li><a href="https://lint.travis-ci.org/">Travis</a></li>
</ol>

<ul>
  <li>Use CI Web Pages for better output in Web Development Related Projects</li>
</ul>

<p>You can use this script in Gitlab (.gitlab-ci.yml) to obtain the output at 
<em>http://&lt;-USERNAME-OF-GITLAB-&gt;.gitlab.io/&lt;-PROJECT-NAME-&gt;/</em></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pages:
  stage: deploy
  script:
  - mkdir .public
  - cp -r * .public
  - mv .public public
  artifacts:
    paths:
    - public
  only:
  - master
</code></pre></div></div>

<p>For GitHub use the below script in (_config.yml) to obtain the output at 
<em>http://&lt;-USERNAME-OF-GITHUB-&gt;.github.io/&lt;-PROJECT-NAME-&gt;/</em></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>theme: jekyll-theme-cayman
</code></pre></div></div>

<ul>
  <li>Avoid using Polling using GitHub Hooks</li>
</ul>

<p>As correctly said by <a href="http://kohsuke.org/2011/12/01/polling-must-die-triggering-jenkins-builds-from-a-git-hook/">Koshuke</a>, it is important that we adopt new methods to trigger the pipelines.</p>

<ul>
  <li>Use proper checkout strategy</li>
</ul>

<p>One of the mistakes that one can do while checking out multiple repositories in a pipeline is the fact that unintended commit on other repo might be triggering the pipeline. The best command to checkout the repo is this :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>checkout(
poll: false,
scm: [
  $class: 'GitSCM', branches: [[name: '*/master']],
  userRemoteConfigs: [[
    url: MY_URL.git,
    credentialsId: CREDENTIALS_ID]],
  extensions: [
    [$class: 'DisableRemotePoll'],
    [$class: 'PathRestriction', excludedRegions: '', includedRegions: '*']]
])

</code></pre></div></div>

<ul>
  <li>Try Using Python for writing automation scripts</li>
</ul>

<p>Python is a super amazing and fun language to work with. One of the cool reasons why I recommend it is because of the awesome libraries it has support to like <a href="https://pypi.python.org/pypi/PyDictionary/1.3.4">dictionary</a>, <a href="https://docs.python.org/2/library/json.html">json</a>, <a href="https://docs.python.org/2/library/csv.html">csv</a> etc.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Exploring Chef Automate &amp; Habitat has been a heck of a fun task for me. It enabled me to learn more about the upcoming new technologies and its usage in the DevOps world. In the end, I Hope you enjoyed this post,do share this post &amp; tell me your fun experiences with chef in the below comments section.</p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to Ramit Surana</h3>
                    <p>Get the latest posts delivered right to your inbox</p>
                    <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  /><input class="location" type="hidden" name="location"  /><input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email"  placeholder="youremail@example.com" />
    </div>
    <button class="" type="submit" disabled><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>

                </section>
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/images/profile-pic-2.jpg" alt="ramitsurana" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/ramitsurana">Ramit Surana</a></h4>
                                
                                    <p>Author</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/ramitsurana">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script src="https://utteranc.es/client.js"
                        repo="ramitsurana/ramitsurana.github.io"
                        issue-term="title"
                        theme="github-light"
                        crossorigin="anonymous"
                        async>
                    </script>
                    <!-- <script>
                        var disqus_config = function () {
                            var this_page_url = '/ci-cd-chef-automate';
                            var this_page_identifier = '/ci-cd-chef-automate';
                            var this_page_title = 'Automating your CI/CD with Chef Automate & Habitat';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://ramitsurana-github-io.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script> -->
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/storing-non-sensitive-parameters-in-db">
                <div class="post-card-image" style="background-image: url(/assets/images/water.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/storing-non-sensitive-parameters-in-db">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Dynamodb</span>
                            
                        
                            
                               <span class="post-card-tags">Terraform</span>
                            
                        
                            
                                <span class="post-card-tags">Jenkins</span>
                            
                        
                    

                    <h2 class="post-card-title">Why storing non-sensitive parameters in a DB might ease your production deployments?</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>Storing non-sensitive parameters in Dynamodb</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/profile-pic-2.jpg" alt="Ramit Surana" />
                        
                        <span class="post-card-author">
                            <a href="/author/ramitsurana/">Ramit Surana</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      2 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/containers-production">
                <div class="post-card-image" style="background-image: url(/assets/images/sky.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/containers-production">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Containers</span>
                            
                        
                            
                               <span class="post-card-tags">Tips</span>
                            
                        
                            
                                <span class="post-card-tags">Openshift</span>
                            
                        
                    

                    <h2 class="post-card-title">Containers in Production</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>Containers usage tips and tricks.</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/profile-pic-2.jpg" alt="Ramit Surana" />
                        
                        <span class="post-card-author">
                            <a href="/author/ramitsurana/">Ramit Surana</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      4 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="/">
            
                <img src="/assets/images/favicon.png" alt="Ramit Surana icon" />
            
            <span>Ramit Surana</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Automating your CI/CD with Chef Automate & Habitat</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Automating+your+CI%2FCD+with+Chef+Automate+%26+Habitat&amp;url=https://ramitsurana.github.io/ci-cd-chef-automate"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://ramitsurana.github.io/ci-cd-chef-automate"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="/">Ramit Surana</a> &copy; 2021</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    <a href="https://facebook.com/ramitsurana" target="_blank" rel="noopener">Facebook</a>
                    <a href="https://twitter.com/ramitsurana" target="_blank" rel="noopener">Twitter</a>
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
        <div id="subscribe" class="subscribe-overlay">
            <a class="subscribe-overlay-close" href="#"></a>
            <div class="subscribe-overlay-content">
                
                <h1 class="subscribe-overlay-title">Subscribe to Ramit Surana</h1>
                <p class="subscribe-overlay-description">Stay up to date! Get all the latest &amp; greatest posts delivered straight to your inbox</p>
                <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  /><input class="location" type="hidden" name="location"  /><input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email"  placeholder="youremail@example.com" />
    </div>
    <button class="" type="submit" disabled><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>

            </div>
        </div>
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-71344758-1', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
